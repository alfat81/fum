<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- [ДОБАВЛЕНО] Мета-описание для SEO -->
    <meta name="description" content="Календарь соревнований по фигурному управлению мотоциклом (мотоджимхана) на 2025 год. Этапы Кубка России, чемпионаты и региональные соревнования.">
    <title>Календарь соревнований | Комиссия по фигурному управлению мотоциклом | МФР</title>
    <link rel="stylesheet" href="style.css">
    <!-- [ДОБАВЛЕНО] Preconnect для ускорения загрузки шрифтов -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <!-- [ДОБАВЛЕНО] Скринридер-доступный заголовок -->
    <h1 class="visually-hidden">Календарь соревнований по фигурному управлению мотоциклом</h1>
    <div class="container">
        <header class="header">
            <div class="logo-container">
                <!-- [ОПТИМИЗИРОВАНО] Логотип теперь кликабельный и ведет на главную -->
                <a href="index.html" class="logo-link" aria-label="На главную страницу">
                    <div class="logo-left">
                        <img src="images/logo_sm.png" alt="Логотип Комиссии по фигурному управлению мотоциклом" class="logo-img" width="80" height="80">
                    </div>
                    <div class="logo-right">
                        <div class="official-name">МОТОЦИКЛЕТНАЯ ФЕДЕРАЦИЯ РОССИИ</div>
                        <div class="commission-name">КОМИССИЯ ПО ФИГУРНОМУ УПРАВЛЕНИЮ МОТОЦИКЛОМ (МОТОДЖИМХАНА)</div>
                    </div>
                </a>
            </div>
            <button class="menu-toggle" aria-label="Открыть меню" aria-expanded="false" aria-controls="mobile-nav">
                <i class="fas fa-bars" aria-hidden="true"></i>
            </button>
            <nav class="main-nav" aria-label="Основная навигация">
                <ul>
                    <li><a href="index.html" class="nav-link">Главная</a></li>
                    <li><a href="about.html" class="nav-link">О комиссии</a></li>
                    <li><a href="structure.html" class="nav-link">Структура комиссии</a></li>
                    <li><a href="calendar.html" class="nav-link active" aria-current="page">Календарь соревнований</a></li>
                    <li><a href="documents.html" class="nav-link">Полезные документы</a></li>
                    <li><a href="contacts.html" class="nav-link">Контакты</a></li>
                    <li><a href="partners.html" class="nav-link">Партнеры</a></li>
                </ul>
            </nav>
            
            <!-- Mobile menu -->
            <nav class="mobile-menu" id="mobile-nav" aria-label="Мобильная навигация">
                <div class="mobile-nav">
                    <ul>
                        <li><a href="index.html" class="nav-link">Главная</a></li>
                        <li><a href="about.html" class="nav-link">О комиссии</a></li>
                        <li><a href="structure.html" class="nav-link">Структура комиссии</a></li>
                        <li><a href="calendar.html" class="nav-link active" aria-current="page">Календарь соревнований</a></li>
                        <li><a href="documents.html" class="nav-link">Полезные документы</a></li>
                        <li><a href="contacts.html" class="nav-link">Контакты</a></li>
                        <li><a href="partners.html" class="nav-link">Партнеры</a></li>
                    </ul>
                </div>
            </nav>
        </header>

        <main class="content">
            <h1 class="page-title">Календарь соревнований 2025 года</h1>
            
            <section class="calendar-section" aria-labelledby="calendar-heading">
                <div class="calendar-controls">
                    <button class="calendar-btn" id="prev-month" aria-label="Предыдущий месяц">
                        <i class="fas fa-chevron-left" aria-hidden="true"></i>
                    </button>
                    <h2 id="calendar-heading" class="current-month" id="current-month">Май 2025</h2>
                    <button class="calendar-btn" id="next-month" aria-label="Следующий месяц">
                        <i class="fas fa-chevron-right" aria-hidden="true"></i>
                    </button>
                </div>
                
                <div class="calendar-grid" id="calendar-grid" role="grid" aria-label="Календарь соревнований">
                    <!-- Дни календаря будут добавлены через JavaScript -->
                </div>
            </section>
            
            <section class="competitions-section" aria-labelledby="competitions-heading">
                <h2 id="competitions-heading" class="section-title">Предстоящие соревнования</h2>
                
                <div class="competitions-list" id="competitions-container" role="list" aria-label="Список соревнований">
                    <!-- Соревнования будут загружены из localStorage -->
                </div>
            </section>
        </main>

        <footer class="footer" aria-label="Подвал сайта">
            <div class="footer-logos">
                <a href="https://www.mfr.ru/" target="_blank" rel="noopener noreferrer">
                    <img src="images/mfr_logo.png" alt="Логотип Мотоциклетной Федерации России" width="100" height="60">
                </a>
                <a href="https://www.minsport.gov.ru/" target="_blank" rel="noopener noreferrer">
                    <img src="images/logo_minsport.png" alt="Логотип Министерства спорта Российской Федерации" width="100" height="60">
                </a>
            </div>
            <div class="footer-links">
                <a href="documents.html" class="document-link">Документы комиссии</a>
                <a href="https://www.mfr.ru/" target="_blank" rel="noopener noreferrer">Официальный сайт МФР</a>
                <a href="https://www.mfr.ru/disciplines/motodzhimkhana/" target="_blank" rel="noopener noreferrer">Страница мотоджимханы на сайте МФР</a>
            </div>
            <div class="copyright">
                © 2025 Мотоциклетная Федерация России
            </div>
        </footer>
    </div>

    <!-- Admin tab -->
    <!-- [ОПТИМИЗИРОВАНО] Админ-панель скрыта от индексации и вспомогательных технологий -->
    <div class="admin-tab" id="admin-tab" aria-hidden="true" tabindex="-1" role="button" aria-label="Открыть панель администратора">
        <i class="fas fa-cog" aria-hidden="true"></i>
    </div>

    <div class="admin-panel" id="admin-panel" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Панель администратора" hidden>
        <!-- Содержимое админ-панели осталось без изменений, но скрыто атрибутом hidden и управляется JS -->
        <div class="admin-header">
            <h2>Админ-панель</h2>
            <button class="close-admin-panel" id="close-admin-panel" aria-label="Закрыть панель администратора">
                <i class="fas fa-times" aria-hidden="true"></i>
            </button>
        </div>
        <!-- ... остальное содержимое админ-панели без изменений ... -->
    </div>

    <!-- [ИЗМЕНЕНО] Добавлен defer к основному скрипту, встроенный скрипт оставлен для календаря -->
    <script src="script.js" defer></script>
    <script>
        // [ОПТИМИЗАЦИЯ] Функции для календаря выделены в отдельный модуль
        document.addEventListener('DOMContentLoaded', function() {
            // Проверяем, есть ли необходимые элементы на странице
            if (!document.getElementById('calendar-grid') || !document.getElementById('competitions-container')) {
                console.log('Элементы календаря не найдены, скрипт не запущен');
                return;
            }
            
            console.log('Инициализация календаря соревнований');

            // Функция для получения сохраненных соревнований
            function getCompetitions() {
                try {
                    const savedCompetitions = localStorage.getItem('competitionsList');
                    return savedCompetitions ? JSON.parse(savedCompetitions) : getDefaultCompetitions();
                } catch (error) {
                    console.error('Ошибка при загрузке соревнований:', error);
                    return getDefaultCompetitions();
                }
            }

            // Стандартные соревнования по умолчанию
            function getDefaultCompetitions() {
                return [
                    {
                        id: 1,
                        date: '2025-05-12',
                        name: '2 этап Кубка России по фигурному управлению мотоциклом',
                        location: 'Смоленск',
                        contact: 'Глеб Симдянкин',
                        contactPhone: '+7 (910) 345-67-89',
                        protocol: ''
                    },
                    {
                        id: 2,
                        date: '2025-05-20',
                        name: 'Кубок Москвы',
                        location: 'Москва',
                        contact: 'Александр Ципилев',
                        contactPhone: '+7 (903) 123-45-67',
                        protocol: ''
                    },
                    {
                        id: 3,
                        date: '2025-06-15',
                        name: 'Чемпионат России',
                        location: 'Тверская область',
                        contact: 'Дмитрий Серов',
                        contactPhone: '+7 (977) 823-63-90',
                        protocol: ''
                    },
                    {
                        id: 4,
                        date: '2025-08-05',
                        name: 'Женский Кубок МФР',
                        location: 'Нижний Новгород',
                        contact: 'Алексей Фатьянов',
                        contactPhone: '+7 (905) 234-56-78',
                        protocol: ''
                    },
                    {
                        id: 5,
                        date: '2025-09-12',
                        name: 'Кубок юниоров',
                        location: 'Вологда',
                        contact: 'Наталия Недайводина',
                        contactPhone: '+7 (911) 456-78-90',
                        protocol: ''
                    }
                ];
            }

            // Отображение списка соревнований
            function renderCompetitions() {
                const competitions = getCompetitions();
                const container = document.getElementById('competitions-container');
                
                if (!container) return;
                
                // Сортируем соревнования по дате
                competitions.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                // Фильтруем только будущие соревнования
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const upcomingCompetitions = competitions.filter(comp => new Date(comp.date) >= today);
                const pastCompetitions = competitions.filter(comp => new Date(comp.date) < today);
                
                container.innerHTML = '';
                
                if (upcomingCompetitions.length === 0 && pastCompetitions.length === 0) {
                    container.innerHTML = '<p class="no-competitions">Пока нет запланированных соревнований</p>';
                    return;
                }
                
                // Отображаем предстоящие соревнования
                if (upcomingCompetitions.length > 0) {
                    upcomingCompetitions.forEach(comp => {
                        container.appendChild(createCompetitionCard(comp, false));
                    });
                }
                
                // Отображаем прошедшие соревнования в отдельной секции
                if (pastCompetitions.length > 0) {
                    const pastSection = document.createElement('div');
                    pastSection.className = 'past-competitions-section';
                    pastSection.innerHTML = '<h3 class="section-subtitle">Прошедшие соревнования</h3>';
                    
                    pastCompetitions.forEach(comp => {
                        pastSection.appendChild(createCompetitionCard(comp, true));
                    });
                    
                    container.appendChild(pastSection);
                }
            }

            // Создание карточки соревнования
            function createCompetitionCard(comp, isPast) {
                const compCard = document.createElement('article');
                compCard.className = `competition-card ${isPast ? 'past-competition' : ''}`;
                compCard.setAttribute('aria-label', `Соревнование: ${comp.name}`);
                
                compCard.innerHTML = `
                    <div class="competition-date"><time datetime="${comp.date}">${formatDate(comp.date)}</time></div>
                    <h3 class="competition-title">${comp.name}</h3>
                    <div class="competition-location"><i class="fas fa-map-marker-alt" aria-hidden="true"></i> ${comp.location}</div>
                    <div class="competition-contact">
                        <i class="fas fa-user" aria-hidden="true"></i> ${comp.contact}<br>
                        <i class="fas fa-phone" aria-hidden="true"></i> ${comp.contactPhone}
                    </div>
                    ${comp.protocol ? `<div class="protocol-link">
                        <i class="fas fa-file-pdf" aria-hidden="true"></i> <a href="${comp.protocol}" target="_blank" download>Скачать протокол</a>
                    </div>` : ''}
                `;
                
                return compCard;
            }

            // Форматирование даты
            function formatDate(dateString) {
                const date = new Date(dateString);
                const day = date.getDate();
                const month = date.toLocaleString('ru-RU', { month: 'long' });
                const year = date.getFullYear();
                return `${day} ${month} ${year}`;
            }

            // Календарь
            const monthNames = ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", 
                              "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"];
            const dayNames = ["Вс", "Пн", "Вт", "Ср", "Чт", "Пт", "Сб"];
            
            let currentDate = new Date();
            let currentMonth = currentDate.getMonth();
            let currentYear = currentDate.getFullYear();
            
            // Функция отображения календаря
            function renderCalendar(month, year) {
                const calendarGrid = document.getElementById('calendar-grid');
                if (!calendarGrid) return;
                
                calendarGrid.innerHTML = '';
                
                // Обновляем заголовок текущего месяца
                const monthTitle = document.getElementById('calendar-heading');
                if (monthTitle) {
                    monthTitle.textContent = `${monthNames[month]} ${year}`;
                }
                
                // Добавляем заголовки дней недели
                dayNames.forEach(day => {
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'calendar-day-header';
                    dayHeader.textContent = day;
                    dayHeader.setAttribute('role', 'columnheader');
                    dayHeader.setAttribute('aria-label', day);
                    calendarGrid.appendChild(dayHeader);
                });
                
                // Получаем первый день месяца и количество дней в месяце
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const firstDayIndex = firstDay.getDay(); // 0 = воскресенье
                
                // Добавляем пустые дни в начале месяца
                for (let i = 0; i < firstDayIndex; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'calendar-day empty';
                    emptyDay.setAttribute('aria-hidden', 'true');
                    calendarGrid.appendChild(emptyDay);
                }
                
                // Добавляем дни месяца
                const competitions = getCompetitions();
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    dayElement.setAttribute('role', 'gridcell');
                    
                    const currentDay = new Date(year, month, day);
                    const isToday = currentDay.getTime() === today.getTime();
                    const isPast = currentDay < today;
                    
                    let dayClass = 'day-number';
                    if (isToday) dayClass += ' today';
                    if (isPast) dayClass += ' past-day';
                    
                    dayElement.innerHTML = `<div class="${dayClass}">${day}</div>`;
                    
                    // Проверяем, есть ли в этот день соревнования
                    const competitionDate = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                    const dayCompetitions = competitions.filter(comp => comp.date === competitionDate);
                    
                    if (dayCompetitions.length > 0) {
                        dayElement.classList.add('has-competition');
                        dayElement.setAttribute('aria-label', `${day} ${monthNames[month]}: ${dayCompetitions.length} соревнование(ий)`);
                        
                        // Создаем контейнер для соревнований
                        const competitionsContainer = document.createElement('div');
                        competitionsContainer.className = 'day-competitions';
                        
                        dayCompetitions.forEach(comp => {
                            const compElement = document.createElement('div');
                            compElement.className = 'competition-item';
                            compElement.textContent = comp.name;
                            compElement.setAttribute('role', 'button');
                            compElement.setAttribute('tabindex', '0');
                            compElement.addEventListener('click', () => {
                                // Прокручиваем к соответствующей карточке соревнования
                                const compCard = document.querySelector(`.competition-card [datetime="${comp.date}"]`);
                                if (compCard && compCard.closest('.competition-card')) {
                                    compCard.closest('.competition-card').scrollIntoView({ behavior: 'smooth' });
                                }
                            });
                            competitionsContainer.appendChild(compElement);
                        });
                        
                        dayElement.appendChild(competitionsContainer);
                    } else {
                        dayElement.setAttribute('aria-label', `${day} ${monthNames[month]}: нет соревнований`);
                    }
                    
                    calendarGrid.appendChild(dayElement);
                }
            }
            
            // Обработчики кнопок навигации
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            
            if (prevMonthBtn) {
                prevMonthBtn.addEventListener('click', function() {
                    currentMonth--;
                    if (currentMonth < 0) {
                        currentMonth = 11;
                        currentYear--;
                    }
                    renderCalendar(currentMonth, currentYear);
                });
            }
            
            if (nextMonthBtn) {
                nextMonthBtn.addEventListener('click', function() {
                    currentMonth++;
                    if (currentMonth > 11) {
                        currentMonth = 0;
                        currentYear++;
                    }
                    renderCalendar(currentMonth, currentYear);
                });
            }
            
            // Начальное отображение
            renderCalendar(currentMonth, currentYear);
            renderCompetitions();
            
            // [ДОБАВЛЕНО] Обработка клавиатурных событий для календаря
            document.addEventListener('keydown', function(e) {
                if (e.key === 'ArrowLeft' && prevMonthBtn) {
                    prevMonthBtn.click();
                } else if (e.key === 'ArrowRight' && nextMonthBtn) {
                    nextMonthBtn.click();
                }
            });
        });
    </script>
</body>
</html>
